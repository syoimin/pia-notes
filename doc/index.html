<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¹ å®Œå…¨ãªãƒ”ã‚¢ãƒåŒæœŸã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .architecture-diagram {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
        }
        .layer {
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            position: relative;
        }
        .hardware-layer {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }
        .server-layer {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        .client-layer {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }
        .communication-layer {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
        }
        .component {
            display: inline-block;
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .arrow {
            text-align: center;
            font-size: 24px;
            margin: 10px 0;
            color: #4CAF50;
        }
        .code-section {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }
        .file-tree {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            line-height: 1.6;
        }
        .flow-step {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        .problem {
            background: #d32f2f;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .solution {
            background: #388e3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
                .file-tree {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre;
            overflow-x: auto;
            border: 1px solid #4a5568;
        }
        
        .file-tree::before {
            content: '';
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¹ ãƒ”ã‚¢ãƒåŒæœŸã‚·ã‚¹ãƒ†ãƒ  - å®Œå…¨æ§‹æˆå›³</h1>

        <div class="problem">
            <h3>âŒ ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã®å•é¡Œ</h3>
            <p>æœ€åˆã®ã€Œãƒ”ã‚¢ãƒåŒæœŸæ¼”å¥ã‚·ã‚¹ãƒ†ãƒ ã€ã¨ãƒ©ã‚ºãƒ‘ã‚¤ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãŒ<strong>åˆ†é›¢ã—ã¦ã„ã‚‹</strong>ãŸã‚ã€å®Ÿéš›ã«ã¯å‹•ä½œã—ã¾ã›ã‚“ã€‚</p>
            <ul>
                <li>HTMLãƒ•ã‚¡ã‚¤ãƒ«ã¯å˜ä½“ãƒ‡ãƒ¢ã¨ã—ã¦ä½œæˆ</li>
                <li>ãƒ©ã‚ºãƒ‘ã‚¤ã‚³ãƒ¼ãƒ‰ã¯åˆ¥é€”WebSocketã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦ä½œæˆ</li>
                <li>ä¸¡è€…ã®<strong>é€£æºéƒ¨åˆ†ãŒæ¬ ã‘ã¦ã„ã‚‹</strong></li>
            </ul>
        </div>

        <div class="solution">
            <h3>âœ… æ­£ã—ã„è§£æ±ºç­–</h3>
            <p>ä»¥ä¸‹ã®ã‚ˆã†ãªçµ±åˆã•ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ æ§‹æˆãŒå¿…è¦ã§ã™ï¼š</p>
        </div>

        <div class="architecture-diagram">
            <h2>ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆ</h2>
            
            <div class="layer hardware-layer">
                <h3>ğŸ”§ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢å±¤</h3>
                <div class="grid-3">
                    <div class="component">
                        <strong>Raspberry Pi 4B</strong><br>
                        Master Controller<br>
                        IP: 192.168.1.100
                    </div>
                    <div class="component">
                        <strong>Android Tablet #1</strong><br>
                        å³æ‰‹ï¼ˆä¸»æ—‹å¾‹ï¼‰<br>
                        IP: 192.168.1.101
                    </div>
                    <div class="component">
                        <strong>Android Tablet #2</strong><br>
                        å·¦æ‰‹ï¼ˆä¼´å¥ï¼‰<br>
                        IP: 192.168.1.102
                    </div>
                </div>
            </div>

            <div class="arrow">â¬‡ï¸</div>

            <div class="layer server-layer">
                <h3>ğŸ–¥ï¸ ã‚µãƒ¼ãƒãƒ¼å±¤ (ãƒ©ã‚ºãƒ‘ã‚¤ä¸Š)</h3>
                <div class="grid-2">
                    <div class="component">
                        <strong>Node.js Server</strong><br>
                        ãƒãƒ¼ãƒˆ: 3000<br>
                        HTMLãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡
                    </div>
                    <div class="component">
                        <strong>WebSocket Server</strong><br>
                        ãƒãƒ¼ãƒˆ: 8080<br>
                        ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
                    </div>
                </div>
            </div>

            <div class="arrow">â¬‡ï¸</div>

            <div class="layer communication-layer">
                <h3>ğŸŒ é€šä¿¡å±¤</h3>
                <div class="grid-3">
                    <div class="component">
                        <strong>HTTPé€šä¿¡</strong><br>
                        HTMLãƒ•ã‚¡ã‚¤ãƒ«å–å¾—<br>
                        åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚
                    </div>
                    <div class="component">
                        <strong>WebSocketé€šä¿¡</strong><br>
                        ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ<br>
                        æ¼”å¥ä¸­å¸¸æ™‚æ¥ç¶š
                    </div>
                    <div class="component">
                        <strong>æœ‰ç·šLAN</strong><br>
                        ä½é…å»¶é€šä¿¡<br>
                        1-5msä»¥å†…
                    </div>
                </div>
            </div>

            <div class="arrow">â¬‡ï¸</div>

            <div class="layer client-layer">
                <h3>ğŸ“± ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå±¤ (ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆä¸Š)</h3>
                <div class="grid-2">
                    <div class="component">
                        <strong>melody.html</strong><br>
                        å³æ‰‹ç”¨UI<br>
                        ä¸»æ—‹å¾‹ãƒãƒ¼ãƒ„è¡¨ç¤º
                    </div>
                    <div class="component">
                        <strong>accompaniment.html</strong><br>
                        å·¦æ‰‹ç”¨UI<br>
                        ä¼´å¥ãƒãƒ¼ãƒ„è¡¨ç¤º
                    </div>
                </div>
            </div>
        </div>

        <div class="code-section">
            <h3>ğŸ“ æ­£ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ</h3>
            <div class="file-tree">
/home/pi/piano-sync/
â”œâ”€â”€ server.js                 â† Node.jsã‚µãƒ¼ãƒãƒ¼ï¼ˆWebSocket + HTTPï¼‰
â”œâ”€â”€ package.json              â† ä¾å­˜é–¢ä¿‚å®šç¾©
â”œâ”€â”€ songs/                    â† æ¥½æ›²ãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ demo.json
â””â”€â”€ public/                   â† Webãƒ•ã‚¡ã‚¤ãƒ«ç¾¤
    â”œâ”€â”€ control.html          â† ãƒã‚¹ã‚¿ãƒ¼åˆ¶å¾¡ãƒ‘ãƒãƒ«
    â”œâ”€â”€ melody.html           â† å³æ‰‹ï¼ˆä¸»æ—‹å¾‹ï¼‰ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤
    â”œâ”€â”€ accompaniment.html    â† å·¦æ‰‹ï¼ˆä¼´å¥ï¼‰ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤
    â”œâ”€â”€ js/
    â”‚   â”œâ”€â”€ piano-client.js   â† ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆJS
    â”‚   â””â”€â”€ piano-sync.js     â† åŒæœŸã‚·ã‚¹ãƒ†ãƒ JS
    â””â”€â”€ css/
        â””â”€â”€ style.css         â† å…±é€šã‚¹ã‚¿ã‚¤ãƒ«
            </div>
        </div>

        <div class="code-section">
            <h3>ğŸ”„ å‹•ä½œãƒ•ãƒ­ãƒ¼</h3>
            
            <div class="flow-step">
                <strong>1. èµ·å‹•ãƒ•ã‚§ãƒ¼ã‚º</strong>
                <p>ãƒ©ã‚ºãƒ‘ã‚¤ã§ <code>node server.js</code> å®Ÿè¡Œ â†’ HTTPã‚µãƒ¼ãƒãƒ¼(3000) + WebSocketã‚µãƒ¼ãƒãƒ¼(8080) ãŒèµ·å‹•</p>
            </div>

            <div class="flow-step">
                <strong>2. æ¥ç¶šãƒ•ã‚§ãƒ¼ã‚º</strong>
                <ul>
                    <li>å³æ‰‹ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ: <code>http://192.168.1.100:3000/melody</code> ã«ã‚¢ã‚¯ã‚»ã‚¹</li>
                    <li>å·¦æ‰‹ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ: <code>http://192.168.1.100:3000/accompaniment</code> ã«ã‚¢ã‚¯ã‚»ã‚¹</li>
                    <li>å„ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãŒè‡ªå‹•çš„ã« <code>ws://192.168.1.100:8080</code> ã« WebSocketæ¥ç¶š</li>
                </ul>
            </div>

            <div class="flow-step">
                <strong>3. åŒæœŸãƒ•ã‚§ãƒ¼ã‚º</strong>
                <ul>
                    <li>ãƒã‚¹ã‚¿ãƒ¼åˆ¶å¾¡ãƒ‘ãƒãƒ«ã§ã€Œæ¼”å¥é–‹å§‹ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹</li>
                    <li>ãƒ©ã‚ºãƒ‘ã‚¤ãŒå…¨ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã«åŒæœŸé–‹å§‹ä¿¡å·é€ä¿¡</li>
                    <li>æŒ‡å®šæ™‚åˆ»ï¼ˆä¾‹ï¼š100mså¾Œï¼‰ã«å…¨ãƒ‡ãƒã‚¤ã‚¹ã§åŒæ™‚ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹</li>
                </ul>
            </div>

            <div class="flow-step">
                <strong>4. æ¼”å¥ãƒ•ã‚§ãƒ¼ã‚º</strong>
                <ul>
                    <li>å„ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãŒåŒã˜ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã§ãƒãƒ¼ãƒ„ã‚’è¡¨ç¤º</li>
                    <li>Web Audio API ã®é«˜ç²¾åº¦ã‚¿ã‚¤ãƒãƒ¼ã§åŒæœŸç¶­æŒ</li>
                    <li>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ†ãƒ³ãƒèª¿æ•´ãƒ»åœæ­¢åˆ¶å¾¡</li>
                </ul>
            </div>
        </div>

        <div class="code-section">
            <h3>ğŸ”— ã‚³ãƒ¼ãƒ‰é–“ã®é€£æº</h3>
            
            <div class="grid-2">
                <div>
                    <h4>server.js (ãƒ©ã‚ºãƒ‘ã‚¤)</h4>
                    <pre><code>// HTTPã‚µãƒ¼ãƒãƒ¼ã§HTMLãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡
app.get('/melody', (req, res) => {
  res.sendFile('public/melody.html');
});

// WebSocketã§åŒæœŸåˆ¶å¾¡
wss.on('connection', (ws) => {
  // ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã¨ã®é€šä¿¡å‡¦ç†
});</code></pre>
                </div>
                <div>
                    <h4>melody.html (ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ)</h4>
                    <pre><code>// WebSocketæ¥ç¶š
const ws = new WebSocket('ws://192.168.1.100:8080');

// åŒæœŸä¿¡å·å—ä¿¡
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.type === 'sync_start') {
    startAnimation(data.startTime);
  }
};</code></pre>
                </div>
            </div>
        </div>

        <div class="solution">
            <h3>ğŸ¯ é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ</h3>
            <ul>
                <li><strong>å˜ä¸€ã‚µãƒ¼ãƒãƒ¼</strong>: ãƒ©ã‚ºãƒ‘ã‚¤ãŒ HTTP + WebSocket ã®ä¸¡æ–¹ã‚’æ‹…å½“</li>
                <li><strong>HTMLãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡</strong>: ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã¯ãƒ©ã‚ºãƒ‘ã‚¤ã‹ã‚‰ç›´æ¥HTMLã‚’å–å¾—</li>
                <li><strong>WebSocketå¸¸æ™‚æ¥ç¶š</strong>: æ¼”å¥ä¸­ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã‚’ç¶­æŒ</li>
                <li><strong>å…±é€šã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</strong>: Web Audio API ã®æ™‚åˆ»ã‚’å…¨ãƒ‡ãƒã‚¤ã‚¹ã§å…±æœ‰</li>
            </ul>
        </div>

        <div class="code-section">
            <h3>ğŸ“‹ æ¬¡ã«å¿…è¦ãªä½œæ¥­</h3>
            <ol>
                <li><strong>çµ±åˆã•ã‚ŒãŸã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰</strong>ã®ä½œæˆ</li>
                <li><strong>ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨HTMLãƒ•ã‚¡ã‚¤ãƒ«</strong>ã®ä½œæˆ</li>
                <li><strong>WebSocketé€šä¿¡éƒ¨åˆ†</strong>ã®å®Ÿè£…</li>
                <li><strong>æ¥½æ›²ãƒ‡ãƒ¼ã‚¿</strong>ã®æº–å‚™</li>
                <li><strong>ãƒ©ã‚ºãƒ‘ã‚¤ã§ã®ãƒ†ã‚¹ãƒˆ</strong>å®Ÿè¡Œ</li>
            </ol>
        </div>

        <p style="text-align: center; margin-top: 40px; font-size: 18px;">
            <strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: å®Œå…¨çµ±åˆç‰ˆã®ã‚³ãƒ¼ãƒ‰ä½œæˆã‚’ã”å¸Œæœ›ã§ã—ãŸã‚‰ã€ãŠç”³ã—ä»˜ã‘ãã ã•ã„ï¼</strong>
        </p>
    </div>
</body>
</html>